<noscript>
  <iframe src="https://www.googletagmanager.com/ns.html?id={{ gtm_id }}"
    height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>

<script>
(function () {
  let loaded = false;

  function loadGTM() {
    if (loaded) return;
    loaded = true;

    const s = document.createElement('script');
    s.src = 'https://www.googletagmanager.com/gtm.js?id={{ gtm_id }}';
    s.async = true;
    document.head.appendChild(s);
  }

  ['scroll','mousemove','touchstart','keydown'].forEach(evt => {
    window.addEventListener(evt, loadGTM, { once: true });
  });

  setTimeout(loadGTM, 4000);
})();
</script>